---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';

const BASE_URL = import.meta.env.BASE_URL;
---

<Layout title="Front AI Drafter | Amber Gianvecchio">
  <Header />
  <main>
    <article class="case-study">
      <!-- Hero Section -->
      <section class="case-hero">
        <div class="container">
          <a href={`${BASE_URL}`} class="back-link">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Home
          </a>
          <h1>Front AI Drafter</h1>
          <p class="case-subtitle">AI-powered customer support system that automatically categorizes messages and generates contextual email draft replies</p>
          <div class="case-meta">
            <div class="meta-item">
              <span class="meta-label">Role</span>
              <span class="meta-value">AI Developer & Operations</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Accuracy</span>
              <span class="meta-value">98%+ accuracy (categorizer, rejection response, initial agents)</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Scale</span>
              <span class="meta-value">17,000+ messages/year</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Overview -->
      <section class="case-content">
        <div class="container">
          <div class="content-grid">
            <div class="content-main">
              <h2 id="overview">Overview</h2>
              <p>
                Built an AI-powered customer support system using OpenAI Agents SDK that automatically categorizes incoming messages and generates contextual email draft replies. The system achieved 98%+ accuracy across the categorizer, rejection response agent, and other initial agents through iterative prompt engineering and comprehensive evaluation workflows.
              </p>
              <p>
                This project demonstrates a complete AI development lifecycle: from initial concept through iterative improvement, testing, and deployment. The workflow integrated multiple tools including Cursor IDE for development, Git for version control, OpenAI Agent Builder for configuration, and Braintrust for evaluation and testing.
              </p>

              <h2 id="challenge">The Challenge</h2>
              <p>
                Managing customer communication at scale required a system that could accurately categorize incoming messages and generate appropriate draft responses. The challenge was building an AI agent system that could:
              </p>
              <ul>
                <li>Accurately categorize diverse customer messages into appropriate categories</li>
                <li>Generate contextually appropriate draft email replies</li>
                <li>Maintain high accuracy through iterative improvement</li>
                <li>Integrate seamlessly into existing customer support workflows</li>
              </ul>

              <h2 id="workflow">Development Workflow</h2>
              <p>
                The project followed a rigorous iterative development cycle that connected multiple tools in a continuous improvement loop. Each step in the workflow builds upon the previous, creating a seamless pipeline from development to deployment.
              </p>

              <div class="workflow-step">
                <h3>1. Development in Cursor IDE</h3>
                <p>
                  All agent development happens in Cursor IDE. I edit agent prompts, instructions, and configurations in <code>src/agents/agentDefinitions.ts</code>. This file contains all agent definitions including the main categorizer, sub-categorizer, and all specialized agents (positive response, rejection response, and 9 sub-agents for the 'other' category).
                </p>
                <p>
                  Common edits include updating agent instructions/prompts, adding few-shot examples to improve agent behavior, adjusting model settings (reasoning effort, temperature, etc.), and updating guardrails configuration (PII detection, moderation, etc.). Before committing, I test changes using local test scripts like <code>replay-test-messages.ts</code> or <code>test-categorizer-failures.ts</code> to verify the agent behaves as expected with sample inputs.
                </p>
                <div class="workflow-image-gallery" data-count="5">
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/cursor-dev-1.png`} alt="Cursor IDE workspace showing project structure" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/cursor-dev-2.png`} alt="Agent definitions file structure" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/cursor-dev-3.png`} alt="Editing agent instructions" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/cursor-dev-4.png`} alt="Local test script execution" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/cursor-dev-5.png`} alt="Categorizer test execution" />
                  </div>
                </div>
              </div>

              <div class="workflow-step">
                <h3>2. Version Control with Git</h3>
                <p>
                  After testing locally, changes move through a structured Git workflow. I pull the latest from the main branch, install dependencies, build and verify locally, then commit changes with descriptive messages. Pull requests enable code review and automated testing through GitHub Actions, ensuring code quality before merging.
                </p>
                <div class="workflow-image-gallery" data-count="3">
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/git-1.png`} alt="Git workflow and commits" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/git-2.png`} alt="Pull request and code review" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/git-3.png`} alt="GitHub Actions automated testing" />
                  </div>
                </div>
              </div>

              <div class="workflow-step">
                <h3>3. Configuration in OpenAI Agent Builder</h3>
                <p>
                  Agent configurations are managed in OpenAI Agent Builder, allowing for easy adjustment of model settings, instructions, and guardrails. If changes were made in Agent Builder, I export updated agents or verify that code changes are reflected correctly. This ensures configuration matches for Braintrust testing and maintains consistency across the development workflow.
                </p>
                <div class="workflow-image-gallery" data-count="5">
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/openai-builder-1.png`} alt="OpenAI Agent Builder dashboard" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/openai-builder-2.png`} alt="Agent configuration settings" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/openai-builder-3.png`} alt="Model settings and guardrails" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/openai-builder-4.png`} alt="Agent instructions configuration" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/openai-builder-5.png`} alt="Guardrails and safety settings" />
                  </div>
                </div>
              </div>

                <div class="workflow-step">
                <h3>4. Testing & Evaluation in Braintrust</h3>
                <p>
                  Braintrust serves as our testing and evaluation platform for validating agent performance before deployment. I use the playground to test agent behavior interactively, configure settings to match Agent Builder, and test different prompts to see how outputs change.
                </p>
                <p>
                  I review detailed traces from agent runs showing how the agent reasoned through responses, tool calls made, step-by-step decision making, and guardrails checks. Manual review of 100-300 traces per iteration ensures quality and accuracy improvements. I test categorization accuracy, verify routing to correct categories, and review draft output quality for tone appropriateness, context understanding, and accuracy of information.
                </p>
                <p>
                  Based on traces, logs, and playground testing, I identify what needs improvement, determine which few-shot examples to add, refine agent instructions, and adjust categorization logic—documenting insights for the next iteration in Cursor.
                </p>
                <div class="workflow-image-gallery" data-count="10">
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-1.png`} alt="Braintrust monitoring logs" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-2.png`} alt="Categorization test results" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-3.png`} alt="Braintrust dashboard" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-4.png`} alt="Project lab overview" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-5.png`} alt="Playground interface for testing prompts" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-6.png`} alt="Trace view showing agent reasoning" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-7.png`} alt="Detailed trace analysis" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-8.png`} alt="Batch trace review interface" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-9.png`} alt="Multiple traces for accuracy verification" />
                  </div>
                  <div class="workflow-image-card">
                    <img src={`${BASE_URL}images/braintrust-10.png`} alt="Draft output quality review" />
                  </div>
                </div>
              </div>

              <h2 id="results">Key Results</h2>
              <div class="results-grid">
                <div class="result-card">
                  <div class="result-number">98%+</div>
                  <div class="result-label">Agent Accuracy</div>
                  <p>Achieved across categorizer, rejection response agent, and initial agents through iterative prompt engineering and comprehensive testing</p>
                </div>
                <div class="result-card">
                  <div class="result-number">17,000+</div>
                  <div class="result-label">Messages Processed Annually</div>
                  <p>Scalable system handling high-volume customer communication</p>
                </div>
              </div>
              <div class="results-grid results-grid-single">
                <div class="result-card">
                  <div class="result-number">Continuous</div>
                  <div class="result-label">Iterative Improvement</div>
                  <p>Established workflow for ongoing refinement and optimization</p>
                </div>
              </div>

              <h2 id="technologies">Technologies & Tools</h2>
              <div class="tags-list">
                <span class="tag">OpenAI Agents SDK</span>
                <span class="tag">TypeScript</span>
                <span class="tag">Braintrust</span>
                <span class="tag">Git</span>
                <span class="tag">Cursor IDE</span>
                <span class="tag">OpenAI Agent Builder</span>
                <span class="tag">GitHub Actions</span>
                <span class="tag">Prompt Engineering</span>
              </div>

              <h2 id="cycle">The Complete Cycle</h2>
              <p>
                The complete iterative workflow connects all tools in a continuous improvement loop. From identifying needs through editing, testing, and validation, each iteration refines agent performance before deployment.
              </p>
              <div class="cycle-steps">
                <div class="cycle-step">
                  <strong>1. Identify Need for Improvement</strong>
                  <p>Trigger points include Braintrust traces showing issues, manual review revealing patterns, playground testing showing unexpected behavior, or monitoring logs indicating trends.</p>
                </div>
                <div class="cycle-step">
                  <strong>2. Edit in Cursor</strong>
                  <p>Make code changes, update agent definitions, modify instructions/prompts, add few-shot examples, and test locally using test scripts.</p>
                </div>
                <div class="cycle-step">
                  <strong>3. Commit and Push (Git Workflow)</strong>
                  <p>Pull latest from main, install dependencies, build and verify locally, commit changes, push to remote, and create pull request. GitHub Actions automatically runs tests and deploys.</p>
                </div>
                <div class="cycle-step">
                  <strong>4. Sync with Agent Builder</strong>
                  <p>Export updated agents from Agent Builder if changes were made there, or verify in Agent Builder that code changes are reflected correctly. Review agent settings to ensure configuration matches for Braintrust testing.</p>
                </div>
                <div class="cycle-step">
                  <strong>5. Test in Braintrust</strong>
                  <p>Configure playground with settings from Agent Builder, test agents interactively with sample messages, run test batches to generate traces, and review 100-300 traces manually for accuracy.</p>
                </div>
                <div class="cycle-step">
                  <strong>6. Review Results and Iterate</strong>
                  <p>Analyze Braintrust results, compare before/after performance, and decide: if results are good → mark complete, ready for next improvement; if results need work → go back to Step 2 to iterate further.</p>
                </div>
              </div>
              <div class="workflow-cycle-container">
                <div class="workflow-cycle">
                  <svg class="workflow-cycle-svg" viewBox="0 0 400 400">
                    <!-- Circular path for animation -->
                    <circle class="workflow-path" cx="200" cy="200" r="150" fill="none" stroke="rgba(255, 255, 255, 0.1)" stroke-width="2" />
                    
                    <!-- Animated indicator dot -->
                    <circle class="workflow-indicator" cx="200" cy="50" r="6" fill="var(--accent)">
                      <animateTransform
                        attributeName="transform"
                        type="rotate"
                        values="0 200 200;360 200 200"
                        dur="8s"
                        repeatCount="indefinite"
                      />
                    </circle>
                    
                    <!-- Arrows connecting steps -->
                    <defs>
                      <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="rgba(255, 255, 255, 0.9)" />
                      </marker>
                    </defs>
                    
                    <!-- Connection lines between steps - properly centered on circle -->
                    <!-- Connection lines between 6 steps - arcs that hug the circle exactly -->
                    <!-- Step 1 (top) to Step 2 (top-right) - 60 degree arc -->
                    <path class="workflow-arrow" d="M 200 50 A 150 150 0 0 1 329.9 125" fill="none" stroke="rgba(255, 255, 255, 0.85)" stroke-width="2.5" marker-end="url(#arrowhead)" />
                    <!-- Step 2 to Step 3 (bottom-right) - 60 degree arc -->
                    <path class="workflow-arrow" d="M 329.9 125 A 150 150 0 0 1 329.9 275" fill="none" stroke="rgba(255, 255, 255, 0.85)" stroke-width="2.5" marker-end="url(#arrowhead)" />
                    <!-- Step 3 to Step 4 (bottom) - 60 degree arc -->
                    <path class="workflow-arrow" d="M 329.9 275 A 150 150 0 0 1 200 350" fill="none" stroke="rgba(255, 255, 255, 0.85)" stroke-width="2.5" marker-end="url(#arrowhead)" />
                    <!-- Step 4 to Step 5 (bottom-left) - 60 degree arc -->
                    <path class="workflow-arrow" d="M 200 350 A 150 150 0 0 1 70.1 275" fill="none" stroke="rgba(255, 255, 255, 0.85)" stroke-width="2.5" marker-end="url(#arrowhead)" />
                    <!-- Step 5 to Step 6 (top-left) - 60 degree arc -->
                    <path class="workflow-arrow" d="M 70.1 275 A 150 150 0 0 1 70.1 125" fill="none" stroke="rgba(255, 255, 255, 0.85)" stroke-width="2.5" marker-end="url(#arrowhead)" />
                    <!-- Step 6 back to Step 1 (completing the loop) - 60 degree arc -->
                    <path class="workflow-arrow" d="M 70.1 125 A 150 150 0 0 1 200 50" fill="none" stroke="rgba(255, 255, 255, 0.85)" stroke-width="2.5" marker-end="url(#arrowhead)" />
                  </svg>
                  
                  <!-- Workflow steps positioned around circle (6 steps evenly spaced at 60 degree intervals) -->
                  <div class="workflow-step-item" data-step="1" style="top: 0; left: 50%; transform: translate(-50%, -100%);">
                    <div class="workflow-step-dot"></div>
                    <div class="workflow-step-label">Identify Issue</div>
                  </div>
                  
                  <div class="workflow-step-item" data-step="2" style="top: 25%; right: 0; transform: translate(50%, -50%);">
                    <div class="workflow-step-dot"></div>
                    <div class="workflow-step-label">Edit in Cursor</div>
                  </div>
                  
                  <div class="workflow-step-item" data-step="3" style="bottom: 25%; right: 0; transform: translate(50%, 50%);">
                    <div class="workflow-step-dot"></div>
                    <div class="workflow-step-label">Git Workflow</div>
                  </div>
                  
                  <div class="workflow-step-item" data-step="4" style="bottom: 0; left: 50%; transform: translate(-50%, 100%);">
                    <div class="workflow-step-dot"></div>
                    <div class="workflow-step-label">Agent Builder Sync</div>
                  </div>
                  
                  <div class="workflow-step-item" data-step="5" style="bottom: 25%; left: 0; transform: translate(-50%, 50%);">
                    <div class="workflow-step-dot"></div>
                    <div class="workflow-step-label">Test in Braintrust</div>
                  </div>
                  
                  <div class="workflow-step-item" data-step="6" style="top: 25%; left: 0; transform: translate(-50%, -50%);">
                    <div class="workflow-step-dot"></div>
                    <div class="workflow-step-label">Review Results</div>
                  </div>
                </div>
              </div>
              
              <p class="workflow-cycle-description">
                The workflow repeats as needed. Each iteration improves agent quality and performance, building toward production readiness.
              </p>

              <h2 id="lessons">Lessons Learned</h2>
              <p>
                This project highlighted the importance of a structured development workflow for AI systems. The iterative cycle of development → testing → evaluation → refinement proved essential for achieving high accuracy. Key learnings included:
              </p>
              <ul>
                <li>The value of comprehensive testing infrastructure for AI systems</li>
                <li>How iterative prompt engineering can dramatically improve accuracy</li>
                <li>The importance of manual trace review in identifying edge cases</li>
                <li>How tool integration enables efficient AI development workflows</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Navigation -->
      <section class="case-navigation">
        <div class="container">
          <a href={`${BASE_URL}`} class="nav-link">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Home
          </a>
        </div>
      </section>
    </article>
  </main>

  <!-- Image Lightbox Modal -->
  <div class="image-lightbox" id="imageLightbox" style="display: none;">
    <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
    <img class="lightbox-image" src="" alt="" />
  </div>

  <!-- Section Navigation Dots (Left Side) -->
  <nav class="section-nav-dots" aria-label="Section navigation">
    <a href="#overview" class="nav-dot" data-section="overview" aria-label="Overview">
      <span class="dot"></span>
      <span class="nav-label">Overview</span>
    </a>
    <a href="#challenge" class="nav-dot" data-section="challenge" aria-label="The Challenge">
      <span class="dot"></span>
      <span class="nav-label">Challenge</span>
    </a>
    <a href="#workflow" class="nav-dot" data-section="workflow" aria-label="Development Workflow">
      <span class="dot"></span>
      <span class="nav-label">Workflow</span>
    </a>
    <a href="#results" class="nav-dot" data-section="results" aria-label="Key Results">
      <span class="dot"></span>
      <span class="nav-label">Results</span>
    </a>
    <a href="#technologies" class="nav-dot" data-section="technologies" aria-label="Technologies & Tools">
      <span class="dot"></span>
      <span class="nav-label">Technologies</span>
    </a>
    <a href="#cycle" class="nav-dot" data-section="cycle" aria-label="The Complete Cycle">
      <span class="dot"></span>
      <span class="nav-label">Cycle</span>
    </a>
    <a href="#lessons" class="nav-dot" data-section="lessons" aria-label="Lessons Learned">
      <span class="dot"></span>
      <span class="nav-label">Lessons</span>
    </a>
  </nav>

  <!-- Floating Scroll Arrows (Right Side) -->
  <div class="scroll-arrows">
    <button class="scroll-arrow scroll-arrow-up" aria-label="Scroll to previous section or top" style="display: none;">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 5 L5 10 M10 5 L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <button class="scroll-arrow scroll-arrow-down" aria-label="Scroll to next section or bottom">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5 10L10 15L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
</Layout>

<script>
  // Pause animation on hover for better interaction
  document.addEventListener('DOMContentLoaded', () => {
    const workflowCycle = document.querySelector('.workflow-cycle');
    const indicator = document.querySelector('.workflow-indicator');
    const animateTransform = indicator?.querySelector('animateTransform');
    
    if (workflowCycle && indicator) {
      workflowCycle.addEventListener('mouseenter', () => {
        if (animateTransform) {
          animateTransform.setAttribute('dur', '999999s'); // Effectively pause
        }
      });
      
      workflowCycle.addEventListener('mouseleave', () => {
        if (animateTransform) {
          animateTransform.setAttribute('dur', '8s'); // Resume
        }
      });
    }
  });

  // Section Navigation
  document.addEventListener('DOMContentLoaded', () => {
    const sections = ['overview', 'challenge', 'workflow', 'results', 'technologies', 'cycle', 'lessons'];
    const navDots = document.querySelectorAll('.nav-dot');
    const scrollUpBtn = document.querySelector('.scroll-arrow-up');
    const scrollDownBtn = document.querySelector('.scroll-arrow-down');
    let currentSectionIndex = 0;

    // Smooth scroll to section
    const scrollToSection = (index) => {
      const sectionId = sections[index];
      const section = document.getElementById(sectionId);
      if (section) {
        const offset = 100; // Offset for fixed header
        const sectionPosition = section.getBoundingClientRect().top + window.pageYOffset - offset;
        window.scrollTo({
          top: sectionPosition,
          behavior: 'smooth'
        });
        currentSectionIndex = index;
        updateActiveDot();
        updateArrowVisibility();
      }
    };

    // Update active dot based on scroll position
    const updateActiveDot = () => {
      navDots.forEach((dot, index) => {
        if (index === currentSectionIndex) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    };

    // Update arrow visibility
    const updateArrowVisibility = () => {
      if (scrollUpBtn) {
        // Show up arrow if not at top of page
        const isAtTop = window.pageYOffset < 100;
        scrollUpBtn.style.display = isAtTop ? 'none' : 'flex';
      }
      if (scrollDownBtn) {
        // Always show down arrow (it will scroll to next section or bottom)
        scrollDownBtn.style.display = 'flex';
      }
    };

    // Detect current section on scroll
    const detectCurrentSection = () => {
      const scrollPosition = window.pageYOffset + window.innerHeight / 3;
      
      for (let i = sections.length - 1; i >= 0; i--) {
        const section = document.getElementById(sections[i]);
        if (section) {
          const sectionTop = section.offsetTop;
          if (scrollPosition >= sectionTop) {
            currentSectionIndex = i;
            updateActiveDot();
            updateArrowVisibility();
            break;
          }
        }
      }
    };

    // Click handlers for navigation dots
    navDots.forEach((dot, index) => {
      dot.addEventListener('click', (e) => {
        e.preventDefault();
        scrollToSection(index);
      });
    });

    // Click handlers for scroll arrows
    if (scrollUpBtn) {
      scrollUpBtn.addEventListener('click', () => {
        if (currentSectionIndex > 0) {
          // Scroll to previous section
          scrollToSection(currentSectionIndex - 1);
        } else {
          // At first section, scroll to top of page
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        }
      });
    }

    if (scrollDownBtn) {
      scrollDownBtn.addEventListener('click', () => {
        if (currentSectionIndex < sections.length - 1) {
          // Scroll to next section
          scrollToSection(currentSectionIndex + 1);
        } else {
          // At last section, scroll to bottom of page
          window.scrollTo({
            top: document.documentElement.scrollHeight,
            behavior: 'smooth'
          });
        }
      });
    }

    // Update on scroll
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(detectCurrentSection, 100);
    });

    // Initial setup
    detectCurrentSection();
    updateArrowVisibility();
  });

  // Image Lightbox
  document.addEventListener('DOMContentLoaded', () => {
    const lightbox = document.getElementById('imageLightbox');
    const lightboxImage = lightbox?.querySelector('.lightbox-image');
    const lightboxClose = lightbox?.querySelector('.lightbox-close');
    const imageCards = document.querySelectorAll('.workflow-image-card img');

    if (!lightbox || !lightboxImage) return;

    // Open lightbox when clicking on an image
    imageCards.forEach((img) => {
      img.addEventListener('click', (e) => {
        e.stopPropagation();
        lightboxImage.src = img.src;
        lightboxImage.alt = img.alt || 'Screenshot';
        lightbox.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
      });
    });

    // Close lightbox functions
    const closeLightbox = () => {
      lightbox.style.display = 'none';
      document.body.style.overflow = ''; // Restore scrolling
    };

    // Close on button click
    if (lightboxClose) {
      lightboxClose.addEventListener('click', (e) => {
        e.stopPropagation();
        closeLightbox();
      });
    }

    // Close on background click
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Close on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && lightbox.style.display === 'flex') {
        closeLightbox();
      }
    });
  });
</script>

<style>
  .case-study {
    padding-top: 80px;
  }

  .case-hero {
    padding: 60px 0 40px;
    background-color: var(--bg-secondary);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 32px;
    color: var(--text-secondary);
    font-size: 0.9rem;
    transition: color var(--transition-fast);
  }

  .back-link:hover {
    color: var(--text-primary);
  }

  .case-hero h1 {
    margin-bottom: 16px;
    color: var(--text-primary);
  }

  .case-subtitle {
    font-size: 1.25rem;
    color: var(--text-secondary);
    margin-bottom: 40px;
    max-width: 800px;
  }

  .case-meta {
    display: flex;
    gap: 48px;
    flex-wrap: wrap;
  }

  .meta-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .meta-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .meta-value {
    font-size: 1rem;
    color: var(--text-primary);
    font-weight: 500;
  }

  .case-image-section {
    padding: 60px 0;
    background-color: var(--bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Device mockup wrapper for hero image */
  .device-mockup {
    position: relative;
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    padding: 20px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
    border-radius: 24px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 
                0 0 0 1px rgba(255, 255, 255, 0.05) inset;
    overflow: hidden; /* Prevent content from spilling out */
  }

  .device-mockup::before {
    content: '';
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
  }

  .case-hero-image {
    width: 100%;
    height: auto;
    max-height: 600px; /* Limit height to prevent giant images */
    object-fit: contain; /* Ensure image fits without distortion */
    border-radius: 12px;
    display: block;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }

  /* Floating card styles for workflow images */
  .workflow-image-card {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    aspect-ratio: 16 / 10; /* Consistent aspect ratio */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .workflow-image-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  }

  .workflow-image-card img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Fit image within card without cropping */
    display: block;
    border: none;
    margin: 0;
    padding: 8px; /* Add padding so images don't touch edges */
  }

  .case-content {
    padding: 80px 0;
  }

  .content-main {
    max-width: 800px;
    margin: 0 auto;
  }

  .content-main h2 {
    margin-top: 48px;
    margin-bottom: 24px;
    color: var(--text-primary);
  }

  .content-main h2:first-child {
    margin-top: 0;
  }

  .content-main h3 {
    margin-top: 32px;
    margin-bottom: 16px;
    color: var(--text-primary);
  }

  .content-main p {
    margin-bottom: 20px;
    line-height: 1.7;
  }

  .content-main ul {
    margin: 20px 0;
    padding-left: 24px;
    color: var(--text-secondary);
  }

  .content-main li {
    margin-bottom: 12px;
    line-height: 1.6;
  }

  .content-main code {
    background-color: var(--bg-secondary);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9em;
    color: var(--accent);
    border: 1px solid var(--border);
  }

  .cycle-steps {
    display: grid;
    gap: 24px;
    margin: 32px 0 80px;
  }

  .cycle-step {
    padding: 24px;
    background-color: var(--bg-secondary);
    border-radius: var(--card-radius);
    border-left: 3px solid var(--accent);
    overflow: hidden;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .cycle-step strong {
    display: block;
    color: var(--accent);
    margin-bottom: 8px;
    font-size: 1.05rem;
  }

  .cycle-step p {
    margin: 0;
    color: var(--text-secondary);
  }

  /* Interactive Workflow Cycle */
  .workflow-cycle-container {
    margin: 80px 0 80px;
    text-align: center;
  }

  .workflow-cycle {
    position: relative;
    width: 400px;
    height: 400px;
    margin: 0 auto 32px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .workflow-cycle-svg {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  .workflow-indicator {
    filter: drop-shadow(0 0 4px var(--accent));
  }

  .workflow-step-item {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
  }

  .workflow-step-item:hover {
    z-index: 10;
  }

  .workflow-step-item:hover .workflow-step-dot {
    background-color: var(--accent);
    box-shadow: 0 0 12px var(--accent);
    transform: scale(1.3);
  }

  .workflow-step-item:hover .workflow-step-label {
    color: var(--accent);
    font-weight: 600;
  }

  .workflow-step-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.6);
    transition: all 0.3s ease;
    margin-bottom: 8px;
  }

  .workflow-step-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    white-space: nowrap;
    transition: all 0.3s ease;
    font-weight: 500;
    background-color: rgba(10, 10, 10, 0.8);
    padding: 2px 6px;
    border-radius: 4px;
    margin-top: 4px;
  }

  .workflow-cycle-description {
    color: var(--text-secondary);
    font-size: 0.95rem;
    max-width: 600px;
    margin: 80px auto 0;
    line-height: 1.6;
    text-align: center;
  }

  /* Pause animation on hover */
  .workflow-cycle:hover .workflow-indicator {
    animation-play-state: paused;
  }

  .workflow-cycle:hover .workflow-indicator animateTransform {
    animation-play-state: paused;
  }

  @media (max-width: 768px) {
    .workflow-cycle {
      width: 300px;
      height: 300px;
    }

    .workflow-step-label {
      font-size: 0.75rem;
    }

    .workflow-cycle-svg {
      transform: scale(0.75);
    }
  }

  .workflow-step {
    margin: 40px 0;
    padding: 32px;
    background-color: var(--bg-card);
    border-radius: var(--card-radius);
    border: 1px solid var(--border);
    overflow: hidden; /* Prevent content from overflowing */
    word-wrap: break-word; /* Break long words */
    overflow-wrap: break-word; /* Additional word breaking */
  }

  .workflow-step h3 {
    margin-top: 0;
    margin-bottom: 16px; /* Add spacing */
    color: var(--accent);
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .workflow-step p {
    margin-bottom: 24px; /* Ensure spacing before images */
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto; /* Add hyphenation for better text wrapping */
  }

  .workflow-image {
    width: 100%;
    max-width: 100%; /* Ensure images don't exceed container */
    height: auto;
    margin-top: 24px;
    margin-bottom: 0; /* Remove bottom margin on last image */
    border-radius: 8px;
    border: 1px solid var(--border);
    display: block; /* Prevent inline spacing issues */
  }

  /* Add spacing between multiple images */
  .workflow-image + .workflow-image {
    margin-top: 16px;
  }

  /* Image gallery for multiple screenshots - more structured and cohesive */
  .workflow-image-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 24px;
    margin-top: 32px;
    align-items: stretch; /* Make all cards same height */
  }

  /* Specific layouts for different numbers of images */
  .workflow-image-gallery[data-count="3"] {
    grid-template-columns: repeat(3, 1fr);
    max-width: 1100px;
    margin-left: auto;
    margin-right: auto;
  }

  .workflow-image-gallery[data-count="5"] {
    grid-template-columns: repeat(3, 1fr);
  }

  .workflow-image-gallery[data-count="5"] .workflow-image-card:nth-child(4),
  .workflow-image-gallery[data-count="5"] .workflow-image-card:nth-child(5) {
    grid-column: span 1;
  }

  .workflow-image-gallery[data-count="10"] {
    grid-template-columns: repeat(3, 1fr);
  }

  @media (max-width: 768px) {
    .workflow-image-gallery {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .device-mockup {
      padding: 12px;
    }

    .device-mockup::before {
      width: 40px;
      height: 3px;
    }
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin: 40px 0;
  }

  .results-grid-single {
    display: flex;
    justify-content: center;
    grid-template-columns: none;
  }

  .results-grid-single .result-card {
    max-width: 400px;
    width: 100%;
  }

  .result-card {
    padding: 32px;
    background-color: var(--bg-card);
    border-radius: var(--card-radius);
    border: 1px solid var(--border);
    text-align: center;
    overflow: hidden;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .result-number {
    font-size: 2rem; /* Reduced from 2.5rem to fit "Continuous" */
    font-weight: 800;
    color: var(--accent);
    margin-bottom: 8px;
    font-family: var(--font-display);
    white-space: nowrap; /* Keep text on one line */
  }

  .result-label {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 12px;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .result-card p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin: 24px 0;
  }

  .tag {
    padding: 8px 16px;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-muted);
    background-color: var(--bg-secondary);
    border-radius: 20px;
    border: 1px solid var(--border);
  }

  .case-navigation {
    padding: 60px 0;
    background-color: var(--bg-secondary);
    border-top: 1px solid var(--border);
  }

  .nav-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--accent);
    font-weight: 500;
    transition: gap var(--transition-fast);
  }

  .nav-link:hover {
    gap: 12px;
  }

  /* Section Navigation Dots (Left Side) */
  .section-nav-dots {
    position: fixed;
    left: 24px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0;
    z-index: 50;
    opacity: 0.6;
    transition: opacity 0.3s ease;
  }

  .section-nav-dots:hover {
    opacity: 1;
  }

  .section-nav-dots::before {
    content: '';
    position: absolute;
    left: 6px;
    top: 0;
    bottom: 0;
    width: 2px;
    background-color: rgba(255, 255, 255, 0.2);
    z-index: 0;
  }

  .nav-dot {
    position: relative;
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: var(--text-secondary);
    transition: all 0.3s ease;
    padding: 16px 0;
    margin: 0;
  }

  .nav-dot .dot {
    width: 10px;
    height: 10px;
    background-color: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.7);
    transition: all 0.3s ease;
    position: relative;
    z-index: 2;
    flex-shrink: 0;
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    box-sizing: border-box;
    -webkit-clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
  }

  .nav-dot .nav-label {
    font-size: 0.85rem;
    font-weight: 500;
    opacity: 0.6;
    transition: opacity 0.3s ease, color 0.3s ease;
    white-space: nowrap;
  }

  .nav-dot:hover .dot,
  .nav-dot.active .dot {
    width: 14px;
    height: 14px;
    background-color: var(--accent);
    border-color: var(--accent);
    border-width: 2px;
    box-shadow: 0 0 8px var(--accent);
  }

  .nav-dot:hover .nav-label,
  .nav-dot.active .nav-label {
    opacity: 1;
    color: var(--accent);
  }

  /* Floating Scroll Arrows (Right Side) */
  .scroll-arrows {
    position: fixed;
    right: 24px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 16px;
    z-index: 50;
  }

  .scroll-arrow {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .scroll-arrow:hover {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: var(--accent);
    color: var(--accent);
    transform: scale(1.1);
  }

  .scroll-arrow:active {
    transform: scale(0.95);
  }

  .scroll-arrow svg {
    width: 20px;
    height: 20px;
  }

  /* Image Lightbox Modal */
  .image-lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
    cursor: pointer;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .lightbox-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
    font-size: 28px;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 1001;
    backdrop-filter: blur(10px);
  }

  .lightbox-close:hover {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: var(--accent);
    color: var(--accent);
    transform: scale(1.1);
  }

  .lightbox-image {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: zoomIn 0.3s ease;
  }

  @keyframes zoomIn {
    from {
      transform: scale(0.9);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  @media (max-width: 768px) {
    .case-meta {
      gap: 24px;
    }

    .workflow-step {
      padding: 24px;
    }

    .results-grid {
      grid-template-columns: 1fr;
    }

    .case-subtitle {
      font-size: 1.1rem;
    }

    .section-nav-dots {
      left: 12px;
      gap: 12px;
    }

    .nav-dot {
      gap: 8px;
    }

    .nav-dot .nav-label {
      font-size: 0.75rem;
    }

    .scroll-arrows {
      right: 12px;
      gap: 12px;
    }

    .scroll-arrow {
      width: 40px;
      height: 40px;
    }

    .image-lightbox {
      padding: 20px;
    }

    .lightbox-close {
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      font-size: 24px;
    }

    .lightbox-image {
      max-width: 95%;
      max-height: 95%;
    }
  }
</style>

